<!DOCTYPE html>
<html>
<head>
    <title>Attendance Records</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h2>Attendance Records</h2>

    <input type="text" id="searchRoll" placeholder="Search by Roll Number">
    <button onclick="search()">Search</button>

    <p id="count"></p>

    <table border="1" width="100%">
        <thead>
            <tr>
                <th>Name</th>
                <th>Roll</th>
                <th>Class</th>
                <th>Date</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <button onclick="exportExcel()">Export to Excel</button>
    <a class="link-btn" href="index.html">Back</a>
</div>

<script>
let records = JSON.parse(localStorage.getItem("attendance")) || [];
let tableBody = document.getElementById("tableBody");

function display(data) {
    tableBody.innerHTML = "";
    let present = 0, absent = 0;

    data.forEach(r => {
        if(r.status === "Present") present++;
        else absent++;

        tableBody.innerHTML += `
        <tr>
            <td>${r.name}</td>
            <td>${r.roll}</td>
            <td>${r.className}</td>
            <td>${r.date}</td>
            <td>${r.status}</td>
        </tr>`;
    });

    document.getElementById("count").innerText =
        `Present: ${present} | Absent: ${absent}`;
}

display(records);

function search() {
    let roll = document.getElementById("searchRoll").value;
    let filtered = records.filter(r => r.roll.includes(roll));
    display(filtered);
}

function exportExcel() {
    let csv = "Name,Roll,Class,Date,Status\n";
    records.forEach(r => {
        csv += `${r.name},${r.roll},${r.className},${r.date},${r.status}\n`;
    });

    let blob = new Blob([csv], { type: "text/csv" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "attendance.csv";
    a.click();
}
</script>

</body>
</html>
